(function(){function k(){f=0;jQuery.each(d,function(a,c){f+=Number(c.slots)})}function l(){k();var a=j-f;jQuery("#p_assigned_slots").html("<strong>Assigned slots:</strong> "+f);jQuery("#p_remaining_slots").html("<strong>Remaining slots:</strong> "+a)}function g(a){if(a){jQuery(a.data).each(function(c,b){jQuery("#id_spin_slot_count_"+b.link_id).val(b.slots);c=jLinq.from(e.data.data).equals("link_id",b.link_id).select()[0];c.slots_ass=b.slots;c.locked=b.locked;d[b.link_id]={slots:b.slots,locked:b.locked};
jQuery("#id_locked_slot_"+b.link_id).attr("checked",b.locked)});l()}jQuery("[id^=button_slot_]").removeAttr("disabled")}function n(){jQuery.getJSON(h+"?_="+(new Date).getTime(),function(a){a&&g(a)})}function o(){jQuery("#button_slot_allocation_recalculate").attr("disabled","disabled");var a=h+"?_="+(new Date).getTime();jQuery.postJSON(a,d,g)}function p(){jQuery("#button_slot_allocation_submit").attr("disabled","disabled");var a=h+"?submit=1&_="+(new Date).getTime();jQuery.postJSON(a,d,g)}function q(){jQuery("#button_slot_allocation_load").attr("disabled",
"disabled");var a=h+"?load=1&_="+(new Date).getTime();jQuery.postJSON(a,d,g)}function r(){var a=this,c=jQuery(a).attr("checked");a=a.id.match(/^id_locked_slot_(\w*)/)[1];d[a].locked=c;jLinq.from(e.data.data).equals("link_id",a).select()[0].locked=c}function s(){var a=this,c=a.id.match(/^id_spin_slot_count_(\w*)/)[1];d[c].slots=jQuery(a).val();jLinq.from(e.data.data).equals("link_id",c).select()[0].slots_ass=jQuery(a).val();k();l()}var i=window.melange;this.prototype=new i.templates._baseTemplate;
this.prototype.constructor=i.templates._baseTemplate;i.templates._baseTemplate.apply(this,arguments);var m=this,j=m.context.total_slots,h=m.context.return_url,f=0,d={},t=["<div class='tooltip'><div class='tooltip-body'>","<img src='/soc/content/"+i.config.app_version+"/images/purrInfo.png' alt='' />","<h3>Slots</h3><p id='p_assigned_slots'></p><p id='p_remaining_slots'></p><p id='p_total_slots'></p></div><div class='tooltip-bottom'></div></div>"].join(""),e;jQuery(function(){jQuery(document).bind("melange_list_loaded",
function(a){e=a.list_object;a=e.jqgrid.object.jqGrid("getRowData");jQuery.each(a,function(c,b){b=b.link_id;e.jqgrid.object.jqGrid("setCell",c+1,"slots_ass",'<div class="slots" id="id_slot_count_container_'+b+'"><input type="text" id="id_spin_slot_count_'+b+'" size="3" value="0"/></div>',null,null);jQuery("#id_spin_slot_count_"+b).bind("change",s);e.jqgrid.object.jqGrid("setCell",c+1,"locked",'<div class="locked" id="id_locked_slot_container_'+b+'"><input type="checkbox" id="id_locked_slot_'+b+'"/></div>',
null,null);jQuery("#id_locked_slot_"+b).bind("change",r)});jQuery("[id^=id_spin_slot_count_]").spin({min:0,max:j});jQuery(t).purr({usingTransparentPNG:true,isSticky:true});jQuery("#p_total_slots").html("<strong>Max slots:</strong> "+j);jQuery("#button_slot_allocation_recalculate").bind("click",o);jQuery("#button_slot_allocation_submit").bind("click",p);jQuery("#button_slot_allocation_load").bind("click",q);n()})});jQuery.postJSON=function(a,c,b){jQuery.ajax({url:a,type:"POST",processData:true,data:{xsrf_token:window.xsrf_token,
result:JSON.stringify(c)},contentType:"application/json",dataType:"json",success:b})}})();
