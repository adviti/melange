(function(a){a.jgrid.extend({editRow:function(g,w,m,s,u,x,v,l,t){var h={keys:w||false,oneditfunc:m||null,successfunc:s||null,url:u||null,extraparam:x||{},aftersavefunc:v||null,errorfunc:l||null,afterrestorefunc:t||null,restoreAfterError:true,mtype:"POST"},o=a.makeArray(arguments).slice(1),b;b=o[0]&&typeof o[0]=="object"&&!a.isFunction(o[0])?a.extend(h,o[0]):h;return this.each(function(){var d=this,c,j,q=0,r=null,p={},k,e;if(d.grid){k=a(d).jqGrid("getInd",g,true);if(k!==false)if((a(k).attr("editable")||
"0")=="0"&&!a(k).hasClass("not-editable-row")){e=d.p.colModel;a("td",k).each(function(f){c=e[f].name;var A=d.p.treeGrid===true&&c==d.p.ExpandColumn;if(A)j=a("span:first",this).html();else try{j=a.unformat(this,{rowId:g,colModel:e[f]},f)}catch(n){j=e[f].edittype&&e[f].edittype=="textarea"?a(this).text():a(this).html()}if(c!="cb"&&c!="subgrid"&&c!="rn"){if(d.p.autoencode)j=a.jgrid.htmlDecode(j);p[c]=j;if(e[f].editable===true){if(r===null)r=f;A?a("span:first",this).html(""):a(this).html("");var i=a.extend({},
e[f].editoptions||{},{id:g+"_"+c,name:c});if(!e[f].edittype)e[f].edittype="text";if(j=="&nbsp;"||j=="&#160;"||j.length==1&&j.charCodeAt(0)==160)j="";i=a.jgrid.createEl(e[f].edittype,i,j,true,a.extend({},a.jgrid.ajaxOptions,d.p.ajaxSelectOptions||{}));a(i).addClass("editable");A?a("span:first",this).append(i):a(this).append(i);e[f].edittype=="select"&&typeof e[f].editoptions!=="undefined"&&e[f].editoptions.multiple===true&&typeof e[f].editoptions.dataUrl==="undefined"&&a.browser.msie&&a(i).width(a(i).width());
q++}}});if(q>0){p.id=g;d.p.savedRow.push(p);a(k).attr("editable","1");a("td:eq("+r+") input",k).focus();b.keys===true&&a(k).bind("keydown",function(f){f.keyCode===27&&a(d).jqGrid("restoreRow",g,t);if(f.keyCode===13){if(f.target.tagName=="TEXTAREA")return true;a(d).jqGrid("saveRow",g,b);return false}f.stopPropagation()});a.isFunction(b.oneditfunc)&&b.oneditfunc.call(d,g)}}}})},saveRow:function(g,w,m,s,u,x,v){var l={successfunc:w||null,url:m||null,extraparam:s||{},aftersavefunc:u||null,errorfunc:x||
null,afterrestorefunc:v||null,restoreAfterError:true,mtype:"POST"},t=a.makeArray(arguments).slice(1),h;h=t[0]&&typeof t[0]=="object"&&!a.isFunction(t[0])?a.extend(l,t[0]):l;var o=false,b=this[0],d,c={},j={},q={},r,p,k;if(!b.grid)return o;k=a(b).jqGrid("getInd",g,true);if(k===false)return o;l=a(k).attr("editable");h.url=h.url?h.url:b.p.editurl;if(l==="1"){var e;a("td",k).each(function(n){e=b.p.colModel[n];d=e.name;if(d!="cb"&&d!="subgrid"&&e.editable===true&&d!="rn"&&!a(this).hasClass("not-editable-cell")){switch(e.edittype){case "checkbox":var i=
["Yes","No"];if(e.editoptions)i=e.editoptions.value.split(":");c[d]=a("input",this).is(":checked")?i[0]:i[1];break;case "text":case "password":case "textarea":case "button":c[d]=a("input, textarea",this).val();break;case "select":if(e.editoptions.multiple){i=a("select",this);var y=[];c[d]=a(i).val();c[d]=c[d]?c[d].join(","):"";a("select option:selected",this).each(function(B,C){y[B]=a(C).text()});j[d]=y.join(",")}else{c[d]=a("select option:selected",this).val();j[d]=a("select option:selected",this).text()}if(e.formatter&&
e.formatter=="select")j={};break;case "custom":try{if(e.editoptions&&a.isFunction(e.editoptions.custom_value)){c[d]=e.editoptions.custom_value.call(b,a(".customelement",this),"get");if(c[d]===undefined)throw"e2";}else throw"e1";}catch(z){z=="e1"&&a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);z=="e2"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):
a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,z.message,jQuery.jgrid.edit.bClose)}break}p=a.jgrid.checkValues(c[d],n,b);if(p[0]===false){p[1]=c[d]+" "+p[1];return false}if(b.p.autoencode)c[d]=a.jgrid.htmlEncode(c[d]);if(h.url!=="clientArray"&&e.editoptions&&e.editoptions.NullIfEmpty===true)if(c[d]=="")q[d]="null"}});if(p[0]===false){try{var f=a.jgrid.findPos(a("#"+a.jgrid.jqID(g),b.grid.bDiv)[0]);a.jgrid.info_dialog(a.jgrid.errors.errcap,p[1],a.jgrid.edit.bClose,{left:f[0],top:f[1]})}catch(A){alert(p[1])}return o}l=
b.p.prmNames;t=l.oper;f=l.id;if(c){c[t]=l.editoper;c[f]=g;if(typeof b.p.inlineData=="undefined")b.p.inlineData={};c=a.extend({},c,b.p.inlineData,h.extraparam)}if(h.url=="clientArray"){c=a.extend({},c,j);b.p.autoencode&&a.each(c,function(n,i){c[n]=a.jgrid.htmlDecode(i)});f=a(b).jqGrid("setRowData",g,c);a(k).attr("editable","0");for(l=0;l<b.p.savedRow.length;l++)if(b.p.savedRow[l].id==g){r=l;break}r>=0&&b.p.savedRow.splice(r,1);a.isFunction(h.aftersavefunc)&&h.aftersavefunc.call(b,g,f);o=true;a(k).unbind("keydown")}else{a("#lui_"+
b.p.id).show();q=a.extend({},c,q);q[f]=a.jgrid.stripPref(b.p.idPrefix,q[f]);a.ajax(a.extend({url:h.url,data:a.isFunction(b.p.serializeRowData)?b.p.serializeRowData.call(b,q):q,type:h.mtype,async:false,complete:function(n,i){a("#lui_"+b.p.id).hide();if(i==="success")if((a.isFunction(h.successfunc)?h.successfunc.call(b,n):true)===true){b.p.autoencode&&a.each(c,function(y,z){c[y]=a.jgrid.htmlDecode(z)});c=a.extend({},c,j);a(b).jqGrid("setRowData",g,c);a(k).attr("editable","0");for(i=0;i<b.p.savedRow.length;i++)if(b.p.savedRow[i].id==
g){r=i;break}r>=0&&b.p.savedRow.splice(r,1);a.isFunction(h.aftersavefunc)&&h.aftersavefunc.call(b,g,n);o=true;a(k).unbind("keydown")}else{a.isFunction(h.errorfunc)&&h.errorfunc.call(b,g,n,i);h.restoreAfterError===true&&a(b).jqGrid("restoreRow",g,h.afterrestorefunc)}},error:function(n,i){a("#lui_"+b.p.id).hide();if(a.isFunction(h.errorfunc))h.errorfunc.call(b,g,n,i);else try{jQuery.jgrid.info_dialog(jQuery.jgrid.errors.errcap,'<div class="ui-state-error">'+n.responseText+"</div>",jQuery.jgrid.edit.bClose,
{buttonalign:"right"})}catch(y){alert(n.responseText)}h.restoreAfterError===true&&a(b).jqGrid("restoreRow",g,h.afterrestorefunc)}},a.jgrid.ajaxOptions,b.p.ajaxRowOptions||{}))}}return o},restoreRow:function(g,w){return this.each(function(){var m=this,s,u,x={};if(m.grid){u=a(m).jqGrid("getInd",g,true);if(u!==false){for(var v=0;v<m.p.savedRow.length;v++)if(m.p.savedRow[v].id==g){s=v;break}if(s>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(u.id)).datepicker("hide")}catch(l){}a.each(m.p.colModel,
function(){if(this.editable===true&&this.name in m.p.savedRow[s]&&!a(this).hasClass("not-editable-cell"))x[this.name]=m.p.savedRow[s][this.name]});a(m).jqGrid("setRowData",g,x);a(u).attr("editable","0").unbind("keydown");m.p.savedRow.splice(s,1)}a.isFunction(w)&&w.call(m,g)}}})}})})(jQuery);
